drop table if EXISTS messages CASCADE ;
drop table if exists serviceProviders CASCADE;
drop table if exists serviceTypes CASCADE;
drop table if exists users CASCADE;
drop table if exists reviews CASCADE;
drop table if exists aptitudes CASCADE;
drop table if exists appointments CASCADE;
drop table if EXISTS temporaryImages CASCADE;
drop table if EXISTS verifyUsers CASCADE;
drop table if exists coordenates cascade;
drop table if exists userImages CASCADE ;


DROP SEQUENCE users_userid_seq IF EXISTS;
CREATE SEQUENCE users_userid_seq as INTEGER;

DROP SEQUENCE serviceTypes_serviceTypeId_seq IF EXISTS;
CREATE SEQUENCE serviceTypes_serviceTypeId_seq as INTEGER;

DROP SEQUENCE aptitudes_aptitudeId_seq IF EXISTS;
CREATE SEQUENCE aptitudes_aptitudeId_seq as INTEGER;

DROP SEQUENCE appointments_appointmentId_seq IF EXISTS;
CREATE SEQUENCE appointments_appointmentId_seq as INTEGER;

DROP SEQUENCE neighborhoods_ngid_seq IF EXISTS;
CREATE SEQUENCE neighborhoods_ngid_seq as INTEGER;

DROP SEQUENCE workingzones_workingZoneId_seq IF EXISTS;
CREATE SEQUENCE workingzones_workingZoneId_seq as INTEGER;

DROP SEQUENCE temporaryImages_imageid_seq IF EXISTS;
CREATE SEQUENCE temporaryImages_imageid_seq as INTEGER;

DROP SEQUENCE temporaryImages_imageid_seq IF EXISTS;
CREATE SEQUENCE temporaryImages_imageid_seq as INTEGER;

DROP SEQUENCE coordenates_coordId_seq IF EXISTS;
CREATE SEQUENCE coordenates_coordId_seq as INTEGER;

DROP SEQUENCE reviews_reviewid_seq IF EXISTS;
CREATE SEQUENCE reviews_reviewid_seq as INTEGER;

DROP SEQUENCE userImages_imageId_seq IF EXISTS;
CREATE SEQUENCE userImages_imageId_seq as INTEGER;


CREATE TABLE IF NOT EXISTS users (
  userid INTEGER GENERATED BY DEFAULT AS SEQUENCE users_userid_seq PRIMARY KEY,
  username varchar(100) UNIQUE NOT NULL ,
  password varchar(100) NOT NULL,
  firstname varchar(100) NOT NULL,
  lastname varchar(100) NOT NULL,
  email varchar(100) NOT NULL,
  phone varchar(100) NOT NULL,
--   image blob,
  address varchar(100) NOT NULL,
  verified boolean
);

CREATE TABLE IF NOT EXISTS serviceTypes (
  serviceTypeId INTEGER GENERATED BY DEFAULT AS SEQUENCE serviceTypes_serviceTypeId_seq PRIMARY KEY,
  serviceName varchar(256)
);

CREATE TABLE IF NOT EXISTS serviceProviders(
  userid INTEGER REFERENCES users(userid) PRIMARY KEY,
  description VARCHAR(1000) NOT NULL
);

CREATE TABLE IF NOT EXISTS aptitudes(
  aptitudeId INTEGER GENERATED BY DEFAULT AS SEQUENCE aptitudes_aptitudeId_seq PRIMARY KEY,
  userid INTEGER REFERENCES serviceProviders(userid),
  serviceTypeId INTEGER REFERENCES serviceTypes(serviceTypeId),
  description VARCHAR(1000) NOT NULL
);

CREATE TABLE IF NOT EXISTS appointments(
  appointmentId INTEGER GENERATED BY DEFAULT AS SEQUENCE appointments_appointmentId_seq PRIMARY KEY,
  userId INTEGER REFERENCES users(userId),
  providerId INTEGER REFERENCES serviceProviders(userId),
  serviceTypeId INTEGER REFERENCES serviceTypes(serviceTypeId),
  appointmentDate TIMESTAMP default CURRENT_DATE,
  address VARCHAR(10000) NOT NULL,
  status VARCHAR(20),
  jobDescription VARCHAR(10000) NOT NULL,
  clientReview boolean default false
);

CREATE TABLE IF NOT EXISTS reviews(
  reviewId INTEGER GENERATED BY DEFAULT AS SEQUENCE users_userid_seq PRIMARY KEY,
  userId INTEGER REFERENCES users(userId),
  aptitudeId INTEGER REFERENCES aptitudes(aptitudeId),
  appointmentId INTEGER REFERENCES appointments(appointmentId),
  reviewdate TIMESTAMP default CURRENT_DATE,
  quality INTEGER,
  cleanness INTEGER,
  price INTEGER,
  punctuality INTEGER,
  treatment INTEGER,
  comment VARCHAR(1000) NOT NULL
);

CREATE TABLE IF NOT EXISTS messages(
  userFrom INTEGER REFERENCES users(userId),
  userTo  INTEGER REFERENCES users(userId),
  message VARCHAR(10000) NOT NULL,
  messageDate TIMESTAMP  default CURRENT_DATE
);


CREATE TABLE IF NOT EXISTS temporaryImages (
  imageid INTEGER GENERATED BY DEFAULT AS SEQUENCE temporaryImages_imageid_seq PRIMARY KEY,
  image   blob
);

create TABLE if NOT EXISTS verifyUsers(
  userId INTEGER PRIMARY KEY REFERENCES users(userId),
  keyCode VARCHAR(1000)
);

CREATE TABLE IF NOT EXISTS coordenates (
  coordId INTEGER GENERATED BY DEFAULT AS SEQUENCE coordenates_coordId_seq PRIMARY KEY,
  userId INTEGER REFERENCES serviceProviders(userId) ,
  pos INTEGER NOT NULL,
  lat DOUBLE precision NOT NULL,
  lng DOUBLE precision NOT NULL,
  unique (userid,pos)
);

CREATE TABLE IF NOT EXISTS userImages (
  imageId INTEGER GENERATED BY DEFAULT AS SEQUENCE coordenates_coordId_seq PRIMARY KEY,
  userId INTEGER  REFERENCES users(userId) NOT NULL UNIQUE,
  image   blob
);

insert into users VALUES(1,'segundofarina','dulcedeleche','Segundo','Farina','segundofarina@me.com','1134373920','cuba 2546',FALSE );
insert into users VALUES(2,'florcavallin','dulcedeleche','Florencia','Cavallin','fcavallin@itba.edu.ar','1140910035','cuba 2546',FALSE);
insert into users VALUES(3,'tinchovictory','dulcedeleche','Martin','Victory','martin@victory.com.ar','1159540388','cuba 2546',FALSE);
insert into users VALUES(4,'carlosrodriguez','dulcedeleche','Carlos','Rodriguez','carlosrod@gmail.com','1156984231','cuba 2546',FALSE);
insert into users VALUES(5,'juliovelez','dulcedeleche','Julio','Velez','julitogallina@hotmail.com','1148526584','cuba 2546',FALSE);
insert into users VALUES(6,'elnue','dulcedeleche','nuevo','usuario','julitogallina@hotmail.com','2323232323','cuba 2546',FALSE);


insert into serviceProviders VALUES(3,'Soy Tincho Victory y no me tomo recreos');
insert into serviceProviders VALUES(4,'Soy Carlitos, trabajo todos los dias hasta las 11 de la ma√±ana');
insert into serviceProviders VALUES(5,'Estudie en el balseiro y no me gusto');

insert into serviceTypes VALUES (1,'Carpintero');
insert into serviceTypes VALUES (2,'Pintor');
insert into serviceTypes VALUES (3,'Obrero');

insert into aptitudes VALUES (1,3,1,'Martin el carpintero');
insert into aptitudes VALUES (2,3,2,'Martinsulis tambien es Pintor');
insert into aptitudes VALUES (3,4,1,'Carlos el carpintero');
insert into aptitudes VALUES (4,4,3,'Carlos obrero');


insert into appointments VALUES (1 , 1 , 3 , 1, DEFAULT , 'cuba 2546'                    , 'Confirmed', 'Hola'                                                                                             , true);
insert into appointments VALUES (2 , 2 , 3 , 2, DEFAULT , 'Av eduardo Madero 399'        , 'Pending'  , 'El calefon no prende el piloto'                                                                   , true);
insert into appointments VALUES (3 , 3 , 4 , 3, DEFAULT , 'Av eduardo Madero 399'        , 'Pending'  , 'ZZXZX'                                                                                            , true);
insert into appointments VALUES (4 , 2 , 4 , 1, DEFAULT , 'Av eduardo Madero 399'        , 'Pending'  , 'ZZXZX'                                                                                            , false);


insert into reviews VALUES (1,1,1,1,default,4,5,3,4,4,'Soy Segundo me encanto tu trabajo de carpinteria Martin');
insert into reviews VALUES (2,1,1,2,default,4,5,3,4,44,'Soy Segundo me encanto tu segundo trabajo de carpinteria Martin');
insert into reviews VALUES (3,2,4,3,default,4,5,3,4,4,'Soy Florencia me encanto el empapelado Martin');

insert into messages VALUES (2,5,'Hola Julio como estas te queria hacer una consulta por el tema de carpinteria',DEFAULT );
insert into messages VALUES (5,2,'Hola Florencia si que necesitas?',DEFAULT );
insert into messages VALUES (2,5,'Necesito hacer un aramrio para zapatillas',DEFAULT );

insert into messages VALUES (2,4,'Este tambien es un chat',DEFAULT );
insert into messages VALUES (4,2,'AAA mira que bueno',DEFAULT );
insert into messages VALUES (2,4,'Jajaja',DEFAULT );


-- insert into appointments VALUES (1,1,3,1,DEFAULT ,'cuba 2546 6p','Pending','soy flor cavallin, tincho haceme un mueble nuevo',false);

INSERT INTO verifyUsers VALUES (1,'673467ehgdudf7chsduy7ds7878ds78s7d8');
INSERT INTO verifyUsers VALUES (2,'78asdyuadshu8743uyhjd78wehwe78dsh78');

INSERT INTO temporaryImages VALUES (1,null);
INSERT INTO temporaryImages VALUES (2,null);

INSERT INTO coordenates (coordId,pos,userid, lat, lng) SELECT userid,1,userid, -34.557176,-58.430436 FROM serviceProviders;
INSERT INTO coordenates (coordId,pos,userid, lat, lng) SELECT userid+1000,2,userid, -34.575376,-58.403839 FROM serviceProviders;
INSERT INTO coordenates (coordId,pos,userid, lat, lng) SELECT userid+2000,3,userid, -34.588696,-58.431428 FROM serviceProviders;



-- SELECT setval('users_userid_seq',               (SELECT MAX(userid)         from users));
-- SELECT setval('serviceTypes_serviceTypeId_seq', (SELECT MAX(serviceTypeId)  from serviceTypes));
-- SELECT setval('aptitudes_aptitudeId_seq',       (SELECT MAX(aptitudeId)     from aptitudes));
-- SELECT setval('appointments_appointmentId_seq', (SELECT MAX(appointmentId)  from appointments));
-- SELECT setval('neighborhoods_ngid_seq',         (SELECT MAX(ngid)           from neighborhoods));
-- SELECT setval('workingzones_workingZoneId_seq', (SELECT MAX(workingZoneId)  from workingzones));
-- SELECT setval('temporaryImages_imageid_seq',    (SELECT MAX(imageid)        from temporaryImages));


ALTER SEQUENCE users_userid_seq RESTART WITH 200;
ALTER SEQUENCE serviceTypes_serviceTypeId_seq RESTART WITH 200;
ALTER SEQUENCE aptitudes_aptitudeId_seq RESTART WITH 200;
ALTER SEQUENCE appointments_appointmentId_seq RESTART WITH 200;
ALTER SEQUENCE neighborhoods_ngid_seq RESTART WITH 200;
ALTER SEQUENCE workingzones_workingZoneId_seq RESTART WITH 200;
ALTER SEQUENCE temporaryImages_imageid_seq RESTART WITH 200;
ALTER SEQUENCE userImages_imageId_seq RESTART WITH 200;
ALTER SEQUENCE reviews_reviewid_seq RESTART WITH 200;

ALTER SEQUENCE coordenates_coordId_seq RESTART WITH 3000;